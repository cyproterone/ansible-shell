#!/usr/bin/env python3

from argparse import ArgumentParser, Namespace
from enum import Enum
from urllib.request import Request, urlopen


class Format(Enum):
  LINE = "line"
  TABLE = "table"
  GRAPH = "graph"


def wttrin_uri(display: Format) -> str:
  if display == Format.LINE:
    return "https://wttr.in?m&format=4"
  elif display == Format.TABLE:
    return "https://wttr.in?mT"
  elif display == Format.GRAPH:
    return "https://v2.wttr.in?mT"
  else:
    raise ValueError()


def wttrin(display: Format) -> str:
  uri = wttrin_uri(display)
  headers = {"User-Agent": "curl",
             "Accept-Language": "zh"}

  req = Request(uri, headers=headers)
  with urlopen(req) as resp:
    return resp.read().decode()


def parse_args() -> Namespace:
  parser = ArgumentParser()
  parser.add_argument("format", nargs="?",
                      type=Format,
                      choices=tuple(f for f in Format),
                      default=Format.TABLE)
  return parser.parse_args()


def main() -> None:
  args = parse_args()
  resp = wttrin(args.format)
  print(resp)


main()
