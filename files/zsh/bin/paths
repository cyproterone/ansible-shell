#!/usr/bin/env python3


from argparse import ArgumentParser, Namespace
from os import environ
from os.path import isdir
from sys import stderr
from typing import List, Iterable


def parse_args() -> Namespace:
  parser = ArgumentParser()
  parser.add_argument("command", choices=("add", "remove", "toggle"))
  parser.add_argument("path")
  parser.add_argument("-s", "--silent", action="store_true")
  return parser.parse_args()


def remove(path: str, paths: List[str], silent: bool) -> Iterable[str]:
  if not silent:
    print(f"REMOVE -- {path}", file=stderr)
  return (p for p in paths if p != path)


def add(path: str, paths: List[str], silent: bool) -> Iterable[str]:
  if not silent:
    print(f"ADD    -- {path}", file=stderr)
  return (path, *remove(path, paths, True))


def toggle(path: str, paths: List[str], silent: bool) -> Iterable[str]:
  return (remove if path in paths else add)(path, paths, silent)


def p_path(command: str, path: str, silent: bool) -> Iterable[str]:
  paths = environ["PATH"].split(":")

  if command == "add":
    return add(path, paths, silent)
  elif command == "remove":
    return remove(path, paths, silent)
  elif command == "toggle":
    return toggle(path, paths, silent)
  else:
    assert False


def main() -> None:
  args = parse_args()
  if not isdir(args.path):
    print(f"ERR :: Not A Directory -- {args.path}", file=stderr)
  else:
    paths = p_path(args.command, args.path, args.silent)
    print(*paths, sep=":")


main()

