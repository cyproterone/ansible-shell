---

- name: set default shell
  user:
    name: root
    shell: /bin/zsh


- name: add ssh pub key
  authorized_key:
    user: root
    key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"


- name: enable root login
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    line: "PermitRootLogin yes"
  register: __root_ssh


- name: restart sshd
  when: __root_ssh.changed
  systemd:
    name: sshd
    state: restarted

- name: set root_pw
  when: root_pw is defined
  user:
    name: root
    password: "{{ root_pw | password_hash('sha512') }}"
