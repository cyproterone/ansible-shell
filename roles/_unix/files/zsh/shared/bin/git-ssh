#!/usr/bin/env python3

from argparse import ArgumentParser, Namespace
from pathlib import Path
from shlex import join, quote

_CMD = "GIT_SSH_COMMAND"


def _parse_args() -> Namespace:
    parser = ArgumentParser()
    parser.add_argument("path", nargs="?")
    return parser.parse_args()


def main() -> None:
    args = _parse_args()
    unset = f"unset {_CMD}"

    if args.path:
        path = Path.home() / ".ssh" / str(args.path)
        if path.exists():
            cmd = quote(join(("ssh", "-o", "IdentitiesOnly=yes", "-i", str(path))))
            print(f"export {_CMD}={cmd}", end="")
        else:
            print(unset, end="")
    else:
        print(unset, end="")


main()
